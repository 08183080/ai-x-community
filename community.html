<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIç¤¾ç¾¤</title>
  <style>
    :root {
      --primary-color: #00ff88;
      --primary-color-dark: #00cc6a;
      --primary-color-light: #33ffaa;
      --accent-color: #00d4ff;
      --bg-gradient-start: #0a0a0a;
      --bg-gradient-end: #1a1a2e;
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(0, 255, 136, 0.2);
      --glass-border-hover: rgba(0, 255, 136, 0.4);
      --text-primary: #00ff88;
      --text-secondary: rgba(0, 255, 136, 0.7);
      --text-muted: rgba(0, 255, 136, 0.5);
      --shadow-glow: rgba(0, 255, 136, 0.3);
      --shadow-glow-strong: rgba(0, 255, 136, 0.5);
      --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-fast: all 0.2s ease;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Courier New', monospace;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      background-attachment: fixed;
      color: var(--text-primary);
      overflow-x: hidden;
      min-height: 100vh;
    }

    #canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      opacity: 0.3;
      pointer-events: none;
    }

    .content {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 70px 20px 90px;
    }

    header {
      text-align: center;
      margin-bottom: 34px;
    }

    h1 {
      font-size: 3em;
      font-weight: 300;
      letter-spacing: 0.25em;
      margin-bottom: 14px;
      text-shadow: 0 0 30px var(--shadow-glow-strong);
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.05em;
      opacity: 0.85;
      letter-spacing: 0.12em;
      color: var(--text-secondary);
      margin-bottom: 22px;
    }

    .top-actions {
      display: flex;
      gap: 14px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .cta-button {
      display: inline-block;
      padding: 14px 34px;
      border: 1px solid var(--glass-border-hover);
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--text-primary);
      font-family: 'Courier New', monospace;
      font-size: 0.95em;
      letter-spacing: 0.18em;
      cursor: pointer;
      transition: var(--transition-smooth);
      text-decoration: none;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
      opacity: 0.9;
    }

    .cta-button:hover {
      background: rgba(0, 255, 136, 0.1);
      box-shadow: 0 0 40px var(--shadow-glow-strong);
      transform: translateY(-3px);
      border-color: var(--primary-color);
      opacity: 1;
    }

    .panel {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 18px 18px 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .toolbar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .search {
      flex: 1;
      min-width: min(520px, 100%);
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .search input {
      flex: 1;
      background: rgba(0, 0, 0, 0.25);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 12px 14px;
      color: var(--text-primary);
      font-family: 'Courier New', monospace;
      font-size: 0.95em;
      outline: none;
      transition: var(--transition-fast);
    }

    .search input:focus {
      border-color: var(--glass-border-hover);
      box-shadow: 0 0 12px var(--shadow-glow);
    }

    .search .hint {
      color: var(--text-muted);
      font-size: 0.85em;
      letter-spacing: 0.06em;
      white-space: nowrap;
    }

    .stats {
      color: var(--text-muted);
      font-size: 0.9em;
      letter-spacing: 0.08em;
      white-space: nowrap;
    }

    /* Graph (clean, low-line density) */
    .graph-wrap {
      position: relative;
      width: 100%;
      min-height: 560px;
      padding: 18px 10px 28px;
      border: 1px solid var(--glass-border);
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.18);
      overflow: hidden;
    }

    .graph-lines {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .graph-area {
      position: relative;
      z-index: 1;
      padding: 14px 10px 18px;
    }

    .graph-root {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 18px;
    }

    .graph-categories {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      width: 100%;
      margin-bottom: 16px;
    }

    .node {
      min-width: 180px;
      max-width: 320px;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.35);
      border-radius: 12px;
      color: rgba(255, 255, 255, 0.92);
      font-family: 'Courier New', monospace;
      letter-spacing: 0.06em;
      cursor: pointer;
      transition: var(--transition-smooth);
      text-align: center;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .node.active {
      border-color: rgba(0, 212, 255, 0.85);
      box-shadow: 0 12px 44px rgba(0, 0, 0, 0.5), 0 0 22px rgba(0, 212, 255, 0.22);
    }

    .node:hover {
      transform: translateY(-3px);
      border-color: rgba(255, 255, 255, 0.65);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.45), 0 0 18px rgba(0, 255, 136, 0.25);
    }

    .node:focus-visible {
      outline: 2px solid var(--accent-color);
      outline-offset: 3px;
    }

    .node .badge {
      display: inline-block;
      margin-top: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0, 255, 136, 0.35);
      background: rgba(0, 255, 136, 0.08);
      color: var(--text-secondary);
      font-size: 0.78em;
      letter-spacing: 0.08em;
      white-space: nowrap;
    }

    .node.dim { opacity: 0.25; transform: none; box-shadow: none; }

    .category-detail {
      margin-top: 14px;
      padding-top: 16px;
      border-top: 1px solid rgba(0, 255, 136, 0.18);
    }

    .detail-head {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .detail-title {
      color: var(--text-primary);
      font-size: 1.05em;
      letter-spacing: 0.12em;
      opacity: 0.95;
    }

    .detail-sub {
      color: var(--text-muted);
      font-size: 0.9em;
      letter-spacing: 0.08em;
      opacity: 0.95;
      white-space: nowrap;
    }

    .group-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 14px;
    }

    .group-card {
      text-align: left;
      padding: 14px 14px 12px;
      min-width: 0;
      max-width: none;
    }

    .group-title {
      color: rgba(255, 255, 255, 0.94);
      letter-spacing: 0.06em;
      line-height: 1.35;
      font-size: 0.98em;
      margin-bottom: 8px;
    }

    .group-meta {
      color: var(--text-secondary);
      font-size: 0.86em;
      letter-spacing: 0.05em;
      line-height: 1.55;
      opacity: 0.95;
    }

    .group-pills {
      margin-top: 10px;
    }

    .group-card.dim { opacity: 0.22; box-shadow: none; transform: none; }
    .group-card.match {
      border-color: rgba(0, 212, 255, 0.85);
      box-shadow: 0 12px 44px rgba(0, 0, 0, 0.5), 0 0 22px rgba(0, 212, 255, 0.22);
    }

    .legend {
      margin-top: 12px;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9em;
      letter-spacing: 0.08em;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }
    .modal-overlay.active { display: flex; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .modal-content {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      max-width: 680px;
      width: 100%;
      max-height: 84vh;
      overflow-y: auto;
      padding: 44px 34px 34px;
      position: relative;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 60px var(--shadow-glow);
    }

    .modal-close {
      position: absolute;
      top: 18px;
      right: 22px;
      font-size: 2em;
      cursor: pointer;
      opacity: 0.7;
      transition: var(--transition-fast);
      line-height: 1;
      color: var(--text-primary);
    }
    .modal-close:hover { opacity: 1; transform: rotate(90deg); color: var(--accent-color); }

    .modal-title {
      font-size: 1.7em;
      font-weight: 300;
      letter-spacing: 0.14em;
      margin-bottom: 18px;
      text-align: center;
      text-shadow: 0 0 20px var(--shadow-glow);
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-body {
      font-size: 0.95em;
      line-height: 1.9;
      color: var(--text-secondary);
    }

    .kv {
      margin: 12px 0 0;
      padding: 12px 14px;
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.18);
    }

    .kv strong { color: var(--text-primary); font-weight: 600; }

    .pill {
      display: inline-block;
      margin: 6px 6px 0 0;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--glass-border);
      background: rgba(0, 255, 136, 0.08);
      color: var(--text-secondary);
      font-size: 0.85em;
      letter-spacing: 0.06em;
      white-space: nowrap;
    }

    @media (max-width: 768px) {
      .content { padding: 56px 16px 80px; }
      h1 { font-size: 2.2em; letter-spacing: 0.18em; }
      .subtitle { font-size: 0.98em; letter-spacing: 0.08em; }
      .graph-wrap { min-height: 640px; }
      .node { min-width: 150px; max-width: 92vw; }
      .group-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
      .modal-content { padding: 42px 18px 28px; }
    }
  </style>
</head>
<body>
  <div id="canvas-container"><canvas id="matrix"></canvas></div>

  <main class="content">
    <header>
      <h1>AIç¤¾ç¾¤</h1>
      <div class="subtitle">å¯è§†åŒ–æ ‘å½¢â€œåŒºå—é“¾â€ç»“æ„ Â· ç‚¹å‡»åŒºå—æŸ¥çœ‹è¯¦æƒ…</div>
      <div class="top-actions">
        <a class="cta-button" href="index.html">è¿”å›é¦–é¡µ</a>
        <a class="cta-button" href="forum.html">AIè®ºå›</a>
      </div>
    </header>

    <section class="panel" aria-label="AIç¤¾ç¾¤æ ‘">
      <div class="toolbar">
        <div class="search">
          <input id="searchInput" type="text" placeholder="æœç´¢ç¾¤å / ç¾¤ä¸» / å¾®ä¿¡ / æ ‡ç­¾â€¦" />
          <div class="hint">æ”¯æŒæ¨¡ç³ŠåŒ¹é…</div>
        </div>
        <div class="stats" id="statsText">åŠ è½½ä¸­â€¦</div>
      </div>

      <div class="graph-wrap" id="graphWrap">
        <svg class="graph-lines" id="graphLines" aria-hidden="true"></svg>
        <div class="graph-area" id="graphArea" aria-label="ç¤¾ç¾¤ç»“æ„å›¾ï¼ˆä½å¯†åº¦è¿çº¿ï¼‰">
          <div class="graph-root">
            <button type="button" class="node" id="rootNode" aria-label="æŸ¥çœ‹å…¨éƒ¨ç¤¾ç¾¤">AI+X ç¤¾ç¾¤é“¾<div class="badge" id="rootBadge">åŠ è½½ä¸­</div></button>
          </div>
          <div class="graph-categories" id="categoryRow" aria-label="ç¤¾ç¾¤åˆ†ç±»"></div>

          <div class="category-detail" id="categoryDetail">
            <div class="detail-head">
              <div class="detail-title" id="detailTitle">å…¨éƒ¨ç¤¾ç¾¤</div>
              <div class="detail-sub" id="detailSub">ç‚¹å‡»ä¸Šæ–¹åˆ†ç±»æŸ¥çœ‹åˆ—è¡¨</div>
            </div>
            <div class="group-grid" id="groupGrid" aria-label="ç¤¾ç¾¤åˆ—è¡¨"></div>
          </div>
        </div>
      </div>
      <div class="legend" id="legendText">æç¤ºï¼šä¸»è§†å›¾åªç”»â€œæ ¹ â†’ åˆ†ç±»â€è¿çº¿ï¼›ç¾¤åˆ—è¡¨åœ¨ä¸‹æ–¹å¡ç‰‡åŒºå±•ç¤º</div>
    </section>
  </main>

  <div class="modal-overlay" id="nodeModal" aria-label="èŠ‚ç‚¹ä¿¡æ¯">
    <div class="modal-content">
      <span class="modal-close" id="nodeModalClose">&times;</span>
      <div class="modal-title" id="nodeTitle">èŠ‚ç‚¹</div>
      <div class="modal-body" id="nodeBody"></div>
    </div>
  </div>

  <script>
    // Matrix rain (same vibe as index)
    (function () {
      'use strict';
      const canvas = document.getElementById('matrix');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let columns;
      let drops = [];
      const config = { chars: '01', fontSize: 14, speed: 18, opacity: 0.3, resetProbability: 0.975 };

      function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        columns = Math.floor(canvas.width / config.fontSize);
        drops = [];
        for (let i = 0; i < columns; i++) drops[i] = Math.random() * -100;
      }

      function draw() {
        ctx.fillStyle = `rgba(10, 10, 10, ${0.05 * (1 / config.opacity)})`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#00ff88';
        ctx.font = `${config.fontSize}px Courier New`;
        const charArray = config.chars.split('');
        for (let i = 0; i < drops.length; i++) {
          const text = charArray[Math.floor(Math.random() * charArray.length)];
          const x = i * config.fontSize;
          const y = drops[i] * config.fontSize;
          const op = Math.min(1, (canvas.height - y) / canvas.height);
          ctx.globalAlpha = op * 0.8;
          ctx.fillText(text, x, y);
          ctx.globalAlpha = 1;
          if (y > canvas.height && Math.random() > config.resetProbability) drops[i] = 0;
          drops[i]++;
        }
        requestAnimationFrame(() => setTimeout(draw, config.speed));
      }

      init();
      draw();
      let t;
      window.addEventListener('resize', () => {
        clearTimeout(t);
        t = setTimeout(init, 200);
      });
    })();

    // Data (æ¥æºï¼šAI+Xç¤¾ç¾¤æ¸…å•ã€å…¨ç¤¾ç¾¤ã€‘.pdf)
    // è¯´æ˜ï¼šPDF æåˆ°äºŒç»´ç åˆ—ï¼Œä½†å¯¼å‡ºçš„æ–‡æœ¬é‡Œæ— æ³•ç¨³å®šæ‹¿åˆ°äºŒç»´ç å›¾ç‰‡ï¼Œæ‰€ä»¥æ­¤å¤„ç”¨â€œè”ç³»ç¾¤ä¸»/ç®¡ç†å‘˜å¾®ä¿¡â€ä½œä¸ºå…¥ç¾¤æ–¹å¼ã€‚
    const GROUPS = [
      // æ ¹ç¾¤/æ ¸å¿ƒ
      { id: 'root-aix', name: 'æœ€æ¥åœ°æ°”çš„AIã€AI+Xã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: '500ï¼ˆå·²æ»¡ï¼‰', level: 'æ ¹ç¾¤ï¼ŒåŸå§‹åŒºå—', tags: ['æ ¹ç¾¤', 'æ ¸å¿ƒ'], desc: 'æœ€æ¥åœ°æ°”èŠAIã€‚' },
      { id: 'root-ecnu', name: 'æœ€AIã€AI+åä¸œå¸ˆå¤§ã€‘ï¼ˆ1ç¾¤/2ç¾¤/3ç¾¤ï¼‰', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: '500ï¼ˆå·²æ»¡ï¼‰', level: 'ç¬¬2ä¸ªæ ¹ç¾¤', tags: ['æ ¹ç¾¤', 'é«˜æ ¡'], desc: '70%åå¸ˆå­¦ç”Ÿï¼Œ30%AIåœˆå­èŠAIã€‚' },
      { id: 'root-owners', name: 'æœ€AIã€AI+ç¾¤ä¸»ã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'â€”', level: 'ç¾¤ä¸»ç¾¤', tags: ['æ ¸å¿ƒ'], desc: 'æ‰€æœ‰ AI+ ç¾¤ä¸»çš„ç¾¤ã€‚' },
      { id: 'root-deepseek', name: 'deepseekè¾¹ç•Œæ¢ç´¢ç¾¤ï¼ˆ1ç¾¤~11ç¾¤ï¼‰', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'æ¯ç¾¤200äºº', level: 'ç¤¾ä¼šå®éªŒ/æ‰¿æ¥æµé‡', tags: ['æ ¹ç¾¤', 'å®éªŒ'], desc: 'è°¢è‹¹æœèŠ±äº†3å¤©æ‰¿æ¥ deepseek æµé‡æå‡ºçš„ç¾¤ï¼Œå¯åšç¤¾ä¼šå®éªŒï¼›ç›®å‰æˆä¸ºå¹¿å‘Šç¾¤å’Œè‡ªåª’ä½“äº¤æµç¾¤ã€‚' },
      { id: 'root-love', name: 'æœ€AIã€AI+å©šæ‹ã€‘', owner: 'Gerry', wechat: 'SuperSun77gerry', size: '150+', level: 'æ ¹ç¾¤å¤–ç¤¾åŒºæœ€æ´»è·ƒçš„ç¾¤', tags: ['æ´»è·ƒ', 'ç¤¾äº¤'], desc: 'ä¸å©šä¸æ‹ï¼Œå…«å¦åƒç“œã€‚' },

      // åŸå¸‚ç¾¤
      { id: 'city-sh', name: 'æœ€AIã€AI+ä¸Šæµ·ã€‘', owner: 'ç‰å…”å„¿', wechat: 'U2_my_sunshine', size: '100+', level: 'åŸå¸‚ç¾¤', tags: ['åŸå¸‚ç¾¤', 'ä¸Šæµ·'], desc: 'ä¸Šæµ·åœ°åŒºäº¤æµåˆ†ç¾¤ã€‚' },
      { id: 'city-hz', name: 'æœ€AIã€AI+æ­å·ã€‘', owner: 'æ²æ²', wechat: '15967899445', size: '78', level: 'åŸå¸‚ç¾¤', tags: ['åŸå¸‚ç¾¤', 'æ­å·'], desc: 'æ­å·åœˆå­ AI çˆ±å¥½è€…æ—¥å¸¸äº¤æµã€‚' },
      { id: 'city-gz', name: 'æœ€AIã€AI+å¹¿å·ã€‘', owner: 'å¼ æœˆäº®', wechat: 'MonologueAurora', size: '25', level: 'åŸå¸‚ç¾¤', tags: ['åŸå¸‚ç¾¤', 'å¹¿å·'], desc: 'å¹¿å·åœ°åŒºäº¤æµåˆ†ç¾¤ã€‚' },

      // é«˜æ ¡ç¾¤
      { id: 'uni-suda', name: 'æœ€æ¥åœ°æ°”çš„AIã€AI+è‹å·å¤§å­¦ã€‘', owner: 'å­™å°é±¼', wechat: 'ZhenMing_39', size: '101', level: 'é«˜æ ¡ç¾¤', tags: ['é«˜æ ¡ç¾¤', 'è‹å·å¤§å­¦'], desc: 'è‹å·å¤§å­¦ç›¸å…³äº¤æµã€‚' },

      // èŒä¸š/ä¸»é¢˜/å…´è¶£
      { id: 'job-pm', name: 'æœ€AIã€AI+äº§å“ç»ç†ã€‘', owner: 'æ–‡ä¿Š', wechat: 'xiaoksile', size: '90+', level: 'AI+èŒä¸šï¼šäº§å“', tags: ['èŒä¸šç¾¤', 'äº§å“'], desc: 'æ¬¢è¿å¯¹äº§å“ç»ç†èŒä½æ„Ÿå…´è¶£æˆ–è€…å·²ç»åœ¨å²—çš„äº§å“æœ‹å‹ä»¬ã€‚' },
      { id: 'topic-freelance', name: 'æœ€AIã€AI+è‡ªç”±èŒä¸šã€‘', owner: 'æ–‡ä¿Š', wechat: 'xiaoksile', size: '20+', level: 'AI+ä¸»é¢˜ç³»åˆ—', tags: ['ä¸»é¢˜ç¾¤', 'è‡ªç”±èŒä¸š'], desc: 'æ¬¢è¿å¯¹è‡ªç”±èŒä¸šæ„Ÿå…´è¶£çš„åŒå­¦åŠ å…¥ã€‚' },
      { id: 'topic-english', name: 'æœ€AIã€AI+è‹±è¯­ã€‘', owner: "IF'`Everything", wechat: '13698762557', size: 'â€”', level: 'ä¸»é¢˜ç¾¤', tags: ['ä¸»é¢˜ç¾¤', 'è‹±è¯­'], desc: 'AI + è‹±è¯­å­¦ä¹ äº¤æµã€‚' },
      { id: 'topic-kejia', name: 'æœ€AIã€AI+å®¢å®¶äººã€‘', owner: 'ä¸é¾™å…±å¼ˆ', wechat: '906992048', size: '22', level: 'ä¸»é¢˜ç¾¤', tags: ['ä¸»é¢˜ç¾¤', 'å®¢å®¶'], desc: 'AIï¼Œå®¢å®¶äººäº¤æµã€‚' },
      { id: 'topic-sos', name: 'æœ€AIã€AI+æŠ€æœ¯æ±‚åŠ©sosã€‘', owner: 'ä»˜èƒ½åŠ›è¿…', wechat: '18053698471', size: '60+', level: 'æŠ€æœ¯å‚¨å¤‡åŠ›é‡', tags: ['äº’åŠ©', 'æŠ€æœ¯'], desc: 'AIæŠ€æœ¯äº’åŠ©ï½œç–‘éš¾ç§’è§£ï½œå‰æ²¿èµ„æºå…±äº«ã€‚' },
      { id: 'topic-photo', name: 'æœ€AIã€AI+æ‘„å½±ï½œè‡ªåª’ä½“ã€‘', owner: 'Larry', wechat: '13918390707', size: '40+', level: 'è®¡åˆ’è¿è¥çŸ©é˜µè´¦å·', tags: ['è‡ªåª’ä½“', 'æ‘„å½±'], desc: 'AIèµ‹èƒ½æ‘„å½±ï¼Œè‡ªåª’ä½“èµ›é“æ¢ç´¢ã€‚' },
      { id: 'topic-play', name: 'æœ€AIã€AI+ç©èµš||å·¥å…·-æ•™ç¨‹ã€‘', owner: 'æ•°ç³', wechat: 'sczxm6666', size: '10', level: 'èµ„æº/æ•™ç¨‹/ç©æ³•/å˜ç°', tags: ['å·¥å…·', 'æ•™ç¨‹', 'å˜ç°'], desc: 'èšç„¦AIæœ€æ–°å‰æ²¿èµ„è®¯ï¼Œæœé›†AIç›¸å…³çŸ¥è¯†å’Œå·¥å…·ï¼ŒAIåº”ç”¨å®æ“å’ŒæŠ€å·§ï¼ŒAIç©æ³•æ•™ç¨‹åˆ†äº«å’Œå˜ç°æ–¹æ³•æ‹†è§£ã€‚' },

      // å‚ç›´/å…´è¶£
      { id: 'vertical-film', name: 'æœ€AIï½œAI+å½±è§†åˆ›ä½œã€æ­£è§„ã€‘', owner: 'Donna', wechat: 'BeWithDonna', size: '206', level: 'AI+å½±è§†', tags: ['å½±è§†', 'åˆ›ä½œ'], desc: 'ä¸»åˆ›åœ¨å¹¿å·ï¼Œæƒ³æç§‘å¹»å¤§IPï¼Œæœ‰å…´è¶£çš„æ¥ã€‚' },
      { id: 'vertical-hardware', name: 'æœ€AIã€AI+ç¡¬ä»¶ã€‘', owner: 'å•ƒå“¥', wechat: 'ken2008huang', size: '20+', level: 'AI+ç¡¬ä»¶ç¤¾ç¾¤', tags: ['ç¡¬ä»¶'], desc: 'AI+ç¡¬ä»¶ä¿¡æ¯ã€åº”ç”¨å’ŒæŠ€æœ¯äº¤æµç¾¤ã€‚' },
      { id: 'vertical-edu', name: 'æœ€AIã€AI+æ•™è‚²ã€‘', owner: 'å•ƒå“¥', wechat: 'ken2008huang', size: 'â€”', level: 'AI+æ•™è‚²ç¤¾ç¾¤', tags: ['æ•™è‚²'], desc: 'AI+æ•™è‚²è¡Œä¸šè¶‹åŠ¿ä¿¡æ¯äº¤æµã€‚' },
      { id: 'vertical-discipline', name: 'æœ€AIã€AI+å¥‹æ–—ï½œè‡ªå¾‹ã€‘', owner: 'ä¸èæ˜“', wechat: 'LJS13794539946', size: '28', level: 'è‡ªå¾‹æ‰“å¡', tags: ['è‡ªå¾‹'], desc: 'è‡ªå¾‹æ‰“å¡ä¸äº’ç›¸æ¿€åŠ±ã€‚' },
      { id: 'vertical-metacog', name: 'æœ€AIã€AI+å…ƒè®¤çŸ¥ã€‘', owner: 'é±¼å¾—æ°´', wechat: 'juruo_juruo', size: '9', level: 'å…ƒè®¤çŸ¥', tags: ['è®¤çŸ¥'], desc: 'ä½‘ç¦¾çš„æƒ³æ³•ã€‚' },
      { id: 'vertical-individual', name: 'æœ€AIã€AIè¶…çº§ä¸ªä½“ã€‘', owner: 'é±¼å¾—æ°´', wechat: 'juruo_juruo', size: '38', level: 'ä¸»é¢˜ç¾¤', tags: ['ä¸ªä½“'], desc: 'è¶…çº§ä¸ªä½“æˆé•¿ä¸æ–¹æ³•äº¤æµã€‚' },
      { id: 'vertical-military', name: 'æœ€AIã€AI+å†›äº‹è¿·ã€‘', owner: 'jxj071013', wechat: 'jxj071013', size: 'â€”', level: 'å…´è¶£ç¾¤', tags: ['å†›äº‹'], desc: 'å†›äº‹çˆ±å¥½è€…äº¤æµã€‚' },
      { id: 'vertical-jobhunt', name: 'æœ€AIã€AI+æ±‚èŒã€‘ï¼ˆ1ç¾¤/2ç¾¤ï¼‰', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: '1ç¾¤200äººï¼›2ç¾¤120äºº', level: 'æ±‚èŒ', tags: ['æ±‚èŒ'], desc: 'ä¸€èµ·æ‰¾å·¥ä½œã€‚' },
      { id: 'vertical-director', name: 'æœ€AIã€AI+å¯¼æ¼”ã€‘', owner: 'å¸­åœ°è€Œå', wechat: 'z885086815', size: 'â€”', level: 'å‚ç›´ç¾¤', tags: ['å¯¼æ¼”'], desc: 'å¯¼æ¼”ä¸å†…å®¹åˆ›ä½œäº¤æµã€‚' },
      { id: 'vertical-design', name: 'æœ€AIã€AI+è®¾è®¡ã€‘', owner: 'è°¢è‹¹æœ / X lab', wechat: '19121220286 / heihu0613', size: 'â€”', level: 'å‚ç›´ç¾¤', tags: ['è®¾è®¡'], desc: 'AIåœˆè®¤è¯†é‡åˆ°æˆ¿å±‹è®¾è®¡è¡Œä¸šäººå£«ã€‚' },
      { id: 'vertical-3d', name: 'æœ€AIã€AI+3Dæ‰“å°ã€‘', owner: 'å¾¡é£', wechat: 'foreverTOPLCL', size: '45', level: '3Dæ‰“å°', tags: ['3Dæ‰“å°'], desc: '3Dæ‰“å°äº¤æµã€‚' },
      { id: 'vertical-zxc', name: 'æœ€AIã€AI+å‘¨æ˜Ÿé©°ã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'â€”', level: 'å…´è¶£ç¾¤', tags: ['å‘¨æ˜Ÿé©°'], desc: 'å‘¨æ˜Ÿé©°ç›¸å…³å…´è¶£äº¤æµã€‚' },
      { id: 'vertical-desert', name: 'æœ€AIã€AI+æ²™æ¼ ã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'â€”', level: 'å…´è¶£ç¾¤', tags: ['æ²™æ¼ '], desc: 'æ²™æ¼ ç›¸å…³å…´è¶£äº¤æµã€‚' },
      { id: 'vertical-parttime', name: 'æœ€AIã€AI+å…¼èŒã€‘', owner: 'å­™å°é±¼', wechat: 'ZhenMing_39', size: '51', level: 'å…¼èŒ/å¤–åŒ…', tags: ['å…¼èŒ', 'å¤–åŒ…'], desc: 'AI+å…¼èŒï½œå¤–åŒ…ã€å¼€å‘é€Ÿæ¥ã€‘ã€‚' },
      { id: 'vertical-charity', name: 'æœ€AIã€AI+å…¬ç›Šã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'â€”', level: 'å…¬ç›Š', tags: ['å…¬ç›Š'], desc: 'å…¬ç›Šç›¸å…³äº¤æµã€‚' },
      { id: 'vertical-poetry', name: 'æœ€AIã€AI+è¯—è¯æ­Œèµ‹ã€‘', owner: 'å¼ æœˆäº®', wechat: 'MonologueAurora', size: '10', level: 'è¯—è¯æ­Œèµ‹', tags: ['è¯—è¯'], desc: 'è¯—è¯æ­Œèµ‹äº¤æµã€‚' },
      { id: 'vertical-flea', name: 'æœ€AIã€AI+è·³èš¤å¸‚åœºã€‘', owner: 'ç‰å…”å„¿', wechat: 'U2_my_sunshine', size: '65', level: 'äºŒæ‰‹äº¤æ˜“', tags: ['è·³èš¤å¸‚åœº', 'äºŒæ‰‹'], desc: 'ä»¥åä¸œå¸ˆå¤§äºŒæ‰‹äº¤æ˜“ä¸ºä¸»ã€‚' },
      { id: 'vertical-paint', name: 'æœ€æ¥åœ°æ°”çš„AIã€AI+ç»˜ç”»ã€‘', owner: 'å¾¡é£', wechat: 'foreverTOPLCL', size: 'â€”', level: 'ç»˜ç”»', tags: ['ç»˜ç”»'], desc: 'ç»˜ç”»åˆ›ä½œäº¤æµã€‚' },
      { id: 'vertical-music', name: 'æœ€AIã€AI+éŸ³ä¹ã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'â€”', level: 'éŸ³ä¹', tags: ['éŸ³ä¹'], desc: 'éŸ³ä¹ç›¸å…³äº¤æµã€‚' },
      { id: 'vertical-parenting', name: 'æœ€AIã€è‚²å„¿+AIã€‘', owner: 'å­™å°é±¼', wechat: 'ZhenMing_39', size: 'â€”', level: 'è‚²å„¿', tags: ['è‚²å„¿'], desc: 'è‚²å„¿ä¸AIå·¥å…·ç»éªŒåˆ†äº«ã€‚' },
      { id: 'vertical-reading', name: 'æœ€AIã€AI+è¯»ä¹¦ã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: '11', level: 'è¯»ä¹¦', tags: ['è¯»ä¹¦'], desc: 'è°¢è‹¹æœå’Œä¼™ä¼´ä»¬çš„ä¹¦å•å®‰åˆ©ã€‚' },
      { id: 'vertical-audiobook', name: 'æœ€AIã€AI+å¬ä¹¦ã€‘', owner: 'å›æ´‹', wechat: 'qinamie', size: 'â€”', level: 'å¬ä¹¦', tags: ['å¬ä¹¦'], desc: 'å¬ä¹¦åˆ†äº«ä¸æ¨èã€‚' },
      { id: 'vertical-guoxue', name: 'æœ€AIã€AI+å›½å­¦ã€‘', owner: 'æ²æ²', wechat: '15967899445', size: 'â€”', level: 'å›½å­¦', tags: ['å›½å­¦'], desc: 'å›½å­¦ç›¸å…³äº¤æµã€‚' },
      { id: 'vertical-dailylearn', name: 'æœ€AIã€AI+æ—¥å¸¸å­¦ä¹ ã€‘', owner: 'æ´ªæ³½å®‡', wechat: 'hzyqwo159', size: 'â€”', level: 'æ—¥å¸¸å­¦ä¹ ', tags: ['å­¦ä¹ '], desc: 'æ—¥å¸¸å­¦ä¹ æ‰“å¡ä¸äº¤æµã€‚' },
      { id: 'vertical-imgvideo', name: 'æœ€AIã€AI+å›¾ï½œè§†é¢‘ï½œæ¨¡å‹ã€‘', owner: 'é¹¤ä¹‹', wechat: 'Mercury-High-Flyer-W', size: 'â€”', level: 'å‚ç›´ç¾¤', tags: ['å›¾åƒ', 'è§†é¢‘', 'æ¨¡å‹'], desc: 'å›¾åƒ/è§†é¢‘/æ¨¡å‹ç›¸å…³äº¤æµã€‚' },
      { id: 'vertical-fear', name: 'æœ€AIã€AI+AIææƒ§ã€‘', owner: 'å®‰ç„¶', wechat: 'jiyaoxiezhan01', size: 'â€”', level: 'ä¸»é¢˜ç¾¤', tags: ['å¿ƒç†', 'AIææƒ§'], desc: 'æ–‡ç§‘ç”Ÿå…‹æœAIææƒ§çš„å‹‡æ•¢å¤§ä½œæˆ˜ã€‚' },
      { id: 'vertical-ipvideo', name: 'æœ€AIã€AI+IPè§†é¢‘ã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'â€”', level: 'å‚ç›´ç¾¤', tags: ['IPè§†é¢‘'], desc: 'å¤§æ¨¡å‹æ§åˆ¶åŠ›è¾¹ç•Œæ¢ç´¢ã€‚' },
      { id: 'vertical-pingming', name: 'å¹³æ˜æ•£å®¢', owner: 'å¹³æ˜æ•£å®¢', wechat: 'Ye_Wechat04', size: '52', level: 'æç¤ºè¯/æ§åˆ¶åŠ›', tags: ['æç¤ºè¯', 'æ§åˆ¶'], desc: 'å‘ç°æç¤ºè¯æœ¬åœ°ä¿®æ”¹ç­–ç•¥ï¼Œå®ç°å¤§æ¨¡å‹è¾“å‡º100%çš„æ§åˆ¶ï¼ˆè¾¹ç•Œæ¢ç´¢ï¼‰ã€‚' },
      { id: 'vertical-security', name: 'æœ€AIã€AI+å®‰å…¨ã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'â€”', level: 'å‚ç›´ç¾¤', tags: ['å®‰å…¨'], desc: 'AIå®‰å…¨ç›¸å…³äº¤æµã€‚' },
      { id: 'vertical-ethics', name: 'æœ€AIã€AI+ä¼¦ç†ã€‘', owner: 'è°¢è‹¹æœ', wechat: '19121220286', size: 'â€”', level: 'å‚ç›´ç¾¤', tags: ['ä¼¦ç†'], desc: 'AIä¼¦ç†ç›¸å…³äº¤æµã€‚' },
      { id: 'vertical-essay', name: 'æœ€AIã€AI+ä½œæ–‡æ‰¹æ”¹ï½œé˜…è¯»ç†è§£ã€‘', owner: 'æ–¹', wechat: 'zellyf', size: 'â€”', level: 'å‚ç›´ç¾¤', tags: ['ä½œæ–‡', 'æ•™è‚²'], desc: 'AIå­¦ç”Ÿä½œæ–‡æ‰¹æ”¹ã€é˜…è¯»ç†è§£ç›¸å…³ï¼ˆåœ¨åä¸œå¸ˆå¤§ç†ç§‘æ¥¼ï¼‰ã€‚' },
      { id: 'vertical-travel', name: 'æœ€AIã€AI+æ–‡æ—…ã€‘', owner: 'Niya', wechat: 'NiyaoOolove', size: 'â€”', level: 'å‚ç›´ç¾¤', tags: ['æ–‡æ—…'], desc: 'AI+æ–‡æ—…ç›¸å…³äº¤æµã€‚' },
      { id: 'vertical-uav', name: 'æœ€AIã€AI+æ— äººæœºï½œä½ç©ºç»æµã€‘', owner: 'å¾¡é£', wechat: 'foreverTOPLCL', size: '21', level: 'å‚ç›´ç¾¤', tags: ['æ— äººæœº', 'ä½ç©ºç»æµ'], desc: 'AI+æ— äººæœºï½œä½ç©ºç»æµã€‚' },
      { id: 'vertical-survey', name: 'æœ€AIã€AI+å¡«é—®å·ğŸ”ã€‘', owner: 'å®‰ç„¶', wechat: 'jiyaoxiezhan01', size: 'â€”', level: 'äº’å¸®äº’åŠ©', tags: ['é—®å·'], desc: 'äº’å¸®äº’åŠ©å¡«é—®å·ã€‚' },
      { id: 'vertical-brain', name: 'æœ€AIã€AI+è„‘ç§‘å­¦ã€‘', owner: 'å¼ æœˆäº®', wechat: 'MonologueAurora', size: '15', level: 'å‚ç›´ç¾¤', tags: ['è„‘ç§‘å­¦'], desc: 'çµæ„Ÿæ¥è‡ªå²æ³°é¾™ï¼ˆè‡´è°¢ï¼‰ã€‚' },

      // å…¶ä»–ï¼ˆPDFé‡Œå‡ºç°ä½†ä¿¡æ¯ä¸å®Œæ•´ï¼‰
      { id: 'other-mystery', name: 'æœ€AIã€AI+æœ€AIã€‘', owner: 'ç¥ç§˜äººç‰©', wechat: 'â€”', size: 'â€”', level: 'æœªçŸ¥', tags: ['å…¶ä»–'], desc: 'ï¼ˆå¾…è¡¥å……ï¼‰' }
    ];

    const CATEGORY_ORDER = [
      { id: 'cat-core', label: 'æ ¹ç¾¤/æ ¸å¿ƒ', badge: 'Core', match: g => /æ ¹ç¾¤|æ ¸å¿ƒ|ç¾¤ä¸»ç¾¤|ç¤¾ä¼šå®éªŒ|æ‰¿æ¥æµé‡/.test(g.level) || g.tags.includes('æ ¹ç¾¤') || g.tags.includes('æ ¸å¿ƒ') },
      { id: 'cat-city', label: 'åŸå¸‚ç¾¤', badge: 'City', match: g => g.level.includes('åŸå¸‚ç¾¤') || g.tags.includes('åŸå¸‚ç¾¤') },
      { id: 'cat-uni', label: 'é«˜æ ¡ç¾¤', badge: 'Uni', match: g => g.level.includes('é«˜æ ¡ç¾¤') || g.tags.includes('é«˜æ ¡ç¾¤') || g.tags.includes('é«˜æ ¡') },
      { id: 'cat-job', label: 'èŒä¸šç¾¤', badge: 'Job', match: g => g.level.includes('AI+èŒä¸š') || g.tags.includes('èŒä¸šç¾¤') },
      { id: 'cat-topic', label: 'ä¸»é¢˜ç¾¤', badge: 'Topic', match: g => g.level.includes('ä¸»é¢˜') || g.tags.includes('ä¸»é¢˜ç¾¤') || g.tags.includes('ç¤¾äº¤') },
      { id: 'cat-vertical', label: 'å‚ç›´/å…´è¶£ç¾¤', badge: 'Vertical', match: g => g.level.includes('å‚ç›´') || g.level.includes('å…´è¶£') || ['ç¡¬ä»¶','æ•™è‚²','å½±è§†','è‡ªå¾‹','è®¤çŸ¥','å¯¼æ¼”','è®¾è®¡','3Dæ‰“å°','éŸ³ä¹','ç»˜ç”»','è¯»ä¹¦','å¬ä¹¦','å›½å­¦','å­¦ä¹ ','å®‰å…¨','ä¼¦ç†','è„‘ç§‘å­¦','æ–‡æ—…','æ— äººæœº','é—®å·','æç¤ºè¯','æ±‚èŒ','å…¬ç›Š','è¯—è¯','è·³èš¤å¸‚åœº','è‚²å„¿'].some(t => g.tags.includes(t)) },
      { id: 'cat-other', label: 'å…¶ä»–', badge: 'Other', match: g => true }
    ];

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function normalize(str) {
      return String(str || '').toLowerCase().replace(/\s+/g, '');
    }

    function buildTree() {
      const used = new Set();
      const categories = CATEGORY_ORDER.map(c => ({ id: c.id, label: c.label, badge: c.badge, children: [] }));

      for (const g of GROUPS) {
        let idx = CATEGORY_ORDER.findIndex(c => c.id !== 'cat-other' && c.match(g));
        if (idx === -1) idx = CATEGORY_ORDER.findIndex(c => c.id === 'cat-other');
        categories[idx].children.push(g);
        used.add(g.id);
      }

      // sort groups inside category (by name)
      for (const c of categories) c.children.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'zh-CN'));

      return {
        id: 'aix-chain',
        label: 'AI+X ç¤¾ç¾¤é“¾',
        badge: `å…±${GROUPS.length}ç¾¤`,
        desc: 'æ•°æ®æºï¼šAI+Xç¤¾ç¾¤æ¸…å•ã€å…¨ç¤¾ç¾¤ã€‘.pdfï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜è‡ªè¡Œç»´æŠ¤å…¥ç¾¤æ–¹å¼ï¼‰ã€‚',
        children: categories.map(c => ({
          id: c.id,
          label: c.label,
          badge: `${c.children.length}ç¾¤`,
          children: c.children.map(g => ({
            id: g.id,
            label: g.name,
            badge: g.level,
            meta: g
          }))
        }))
      };
    }

    const TREE_DATA = buildTree();
    const cssEscape = (window.CSS && typeof window.CSS.escape === 'function')
      ? window.CSS.escape
      : (value) => String(value).replace(/[^a-zA-Z0-9_\u00A0-\uFFFF-]/g, '\\$&');

    const graphWrap = document.getElementById('graphWrap');
    const graphArea = document.getElementById('graphArea');
    const linesSvg = document.getElementById('graphLines');
    const rootNode = document.getElementById('rootNode');
    const rootBadge = document.getElementById('rootBadge');
    const categoryRow = document.getElementById('categoryRow');
    const detailTitle = document.getElementById('detailTitle');
    const detailSub = document.getElementById('detailSub');
    const groupGrid = document.getElementById('groupGrid');
    const statsText = document.getElementById('statsText');
    const searchInput = document.getElementById('searchInput');

    const nodeModal = document.getElementById('nodeModal');
    const nodeTitle = document.getElementById('nodeTitle');
    const nodeBody = document.getElementById('nodeBody');
    const nodeModalClose = document.getElementById('nodeModalClose');

    const categories = Array.isArray(TREE_DATA.children) ? TREE_DATA.children : [];
    const groupById = new Map(GROUPS.map(g => [g.id, g]));
    let activeCategoryId = 'all';
    let currentQuery = '';

    function flattenGroups(catId) {
      if (catId === 'all') return GROUPS.slice();
      const cat = categories.find(c => c.id === catId);
      if (!cat || !Array.isArray(cat.children)) return [];
      return cat.children.map(n => n.meta).filter(Boolean);
    }

    function computeMatchIds(q) {
      const nq = normalize(q);
      const matchIds = new Set();
      if (!nq) return matchIds;
      for (const g of GROUPS) {
        const hay = normalize(`${g.name}|${g.owner}|${g.wechat}|${(g.tags || []).join(',')}|${g.level}|${g.desc}`);
        if (hay.includes(nq)) matchIds.add(g.id);
      }
      return matchIds;
    }

    function renderCategoryRow(matchIds) {
      categoryRow.innerHTML = '';
      for (const c of categories) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'node';
        btn.setAttribute('data-cat-id', c.id);
        btn.setAttribute('aria-label', `æŸ¥çœ‹ ${c.label} ç¤¾ç¾¤`);

        const total = Array.isArray(c.children) ? c.children.length : 0;
        const matched = matchIds && matchIds.size
          ? (c.children || []).reduce((acc, n) => acc + (n && n.meta && matchIds.has(n.meta.id) ? 1 : 0), 0)
          : 0;

        const badgeText = (matchIds && matchIds.size)
          ? `${matched}åŒ¹é…`
          : `${total}ç¾¤`;

        btn.innerHTML = `<div>${escapeHtml(c.label)}</div><div class="badge">${escapeHtml(badgeText)}</div>`;

        if (activeCategoryId === c.id) btn.classList.add('active');
        if (matchIds && matchIds.size && matched === 0) btn.classList.add('dim');

        btn.addEventListener('click', () => {
          activeCategoryId = c.id;
          updateView();
        });
        categoryRow.appendChild(btn);
      }
    }

    function renderGroupGrid(groups, matchIds) {
      groupGrid.innerHTML = '';
      if (!groups.length) {
        groupGrid.innerHTML = `<div class="kv" style="grid-column: 1 / -1;"><strong>æ²¡æœ‰ç»“æœ</strong>ï¼šè¯•è¯•æ¢ä¸ªå…³é”®è¯ï¼Œæˆ–ç‚¹å‡»ä¸Šæ–¹åˆ†ç±»ã€‚</div>`;
        return;
      }

      for (const g of groups) {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'node group-card';
        btn.setAttribute('data-group-id', g.id);
        btn.setAttribute('aria-label', `æ‰“å¼€ ${g.name} è¯¦æƒ…`);

        const pills = (g.tags || []).slice(0, 6).map(t => `<span class="pill">${escapeHtml(t)}</span>`).join('');
        const metaLines = [
          g.owner ? `ç¾¤ä¸»/ç®¡ç†å‘˜ï¼š${escapeHtml(g.owner)}` : null,
          g.wechat ? `å¾®ä¿¡ï¼š${escapeHtml(g.wechat)}` : null,
          g.size ? `äººæ•°ï¼š${escapeHtml(g.size)}` : null,
          g.level ? `å±‚çº§ï¼š${escapeHtml(g.level)}` : null
        ].filter(Boolean).join('<br>');

        btn.innerHTML = `
          <div class="group-title">${escapeHtml(g.name)}</div>
          <div class="group-meta">${metaLines}</div>
          ${pills ? `<div class="group-pills">${pills}</div>` : ''}
        `;

        if (matchIds && matchIds.size) {
          if (matchIds.has(g.id)) btn.classList.add('match');
          else btn.classList.add('dim');
        }

        btn.addEventListener('click', () => openGroupModal(g.id));
        groupGrid.appendChild(btn);
      }
    }

    function drawLines() {
      if (!graphWrap || !rootNode || !categoryRow || !linesSvg) return;
      const wrapRect = graphWrap.getBoundingClientRect();
      const width = Math.max(1, Math.round(wrapRect.width));
      const height = Math.max(1, Math.round(wrapRect.height));
      linesSvg.setAttribute('viewBox', `0 0 ${width} ${height}`);
      linesSvg.setAttribute('preserveAspectRatio', 'none');
      linesSvg.innerHTML = '';

      const rr = rootNode.getBoundingClientRect();
      const x1 = (rr.left + rr.right) / 2 - wrapRect.left;
      const y1 = rr.bottom - wrapRect.top;

      const catButtons = Array.from(categoryRow.querySelectorAll('[data-cat-id]'));
      for (const el of catButtons) {
        // if searching and category has 0 matches, skip drawing its line
        if (el.classList.contains('dim')) continue;
        const cr = el.getBoundingClientRect();
        const x2 = (cr.left + cr.right) / 2 - wrapRect.left;
        const y2 = cr.top - wrapRect.top;

        const midY = y1 + (y2 - y1) / 2;
        const d = `M ${x1} ${y1} L ${x1} ${midY} L ${x2} ${midY} L ${x2} ${y2}`;

        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', d);
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke', 'rgba(255, 255, 255, 0.55)');
        path.setAttribute('stroke-width', '2');
        path.setAttribute('stroke-linecap', 'round');
        path.setAttribute('stroke-linejoin', 'round');
        linesSvg.appendChild(path);

        const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        const size = 6;
        arrow.setAttribute('d', `M ${x2} ${y2} L ${x2 - size} ${y2 - size} M ${x2} ${y2} L ${x2 + size} ${y2 - size}`);
        arrow.setAttribute('fill', 'none');
        arrow.setAttribute('stroke', 'rgba(255, 255, 255, 0.55)');
        arrow.setAttribute('stroke-width', '2');
        arrow.setAttribute('stroke-linecap', 'round');
        linesSvg.appendChild(arrow);
      }
    }

    function openRootModal() {
      nodeTitle.textContent = 'AI+X ç¤¾ç¾¤é“¾';
      nodeBody.innerHTML = `
        <div class="kv"><strong>æ•°æ®æº</strong>ï¼šAI+Xç¤¾ç¾¤æ¸…å•ã€å…¨ç¤¾ç¾¤ã€‘.pdf</div>
        <div class="kv"><strong>æ€»ç¤¾ç¾¤æ•°</strong>ï¼š${GROUPS.length}</div>
        <div class="kv"><strong>è¯´æ˜</strong>ï¼šæ•°æ®ç”±ç¾¤ä¸»/ç®¡ç†å‘˜è‡ªè¡Œç»´æŠ¤å…¥ç¾¤æ–¹å¼ï¼›æœ¬é¡µç”¨â€œè”ç³»å¾®ä¿¡â€ä½œä¸ºç»Ÿä¸€å…¥ç¾¤æŒ‡å¼•ã€‚</div>
        <div class="kv"><strong>å»ºè®®</strong>ï¼šåç»­å¯æŒ‰â€œåœ°åŒºç»´åº¦/é«˜æ ¡ç»´åº¦â€è¿›ä¸€æ­¥æ”¶æ‹¢ã€‚</div>
      `;
      nodeModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function openGroupModal(groupId) {
      const g = groupById.get(groupId);
      if (!g) return;
      nodeTitle.textContent = g.name || 'ç¤¾ç¾¤';
      const pills = (g.tags || []).slice(0, 10).map(t => `<span class="pill">${escapeHtml(t)}</span>`).join('');
      nodeBody.innerHTML = `
        <div class="kv"><strong>ç¾¤ä¸»/ç®¡ç†å‘˜</strong>ï¼š${escapeHtml(g.owner || 'â€”')}</div>
        <div class="kv"><strong>å¾®ä¿¡è”ç³»æ–¹å¼</strong>ï¼š${escapeHtml(g.wechat || 'â€”')}</div>
        <div class="kv"><strong>ç¤¾ç¾¤äººæ•°</strong>ï¼š${escapeHtml(g.size || 'â€”')}</div>
        <div class="kv"><strong>ç¤¾ç¾¤å±‚çº§</strong>ï¼š${escapeHtml(g.level || 'â€”')}</div>
        ${g.desc ? `<div class="kv"><strong>ç¤¾åŒºå†…å®¹</strong>ï¼š${escapeHtml(g.desc)}</div>` : ''}
        <div class="kv"><strong>å…¥ç¾¤æ–¹å¼</strong>ï¼šè¯·è”ç³»ç¾¤ä¸»/ç®¡ç†å‘˜å¾®ä¿¡ï¼ˆäºŒç»´ç ç”±ç¾¤ä¸»/ç®¡ç†å‘˜è‡ªè¡Œç»´æŠ¤ï¼‰ã€‚</div>
        ${pills ? `<div class="kv"><strong>æ ‡ç­¾</strong>ï¼š<br>${pills}</div>` : ''}
      `;

      nodeModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeNodeModal() {
      nodeModal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    function updateView() {
      currentQuery = searchInput.value || '';
      const matchIds = computeMatchIds(currentQuery);

      // root badge & stats
      rootBadge.textContent = `å…±${GROUPS.length}ç¾¤`;
      statsText.textContent = `æ”¯æŒæ¨¡ç³ŠåŒ¹é… Â· å…± ${GROUPS.length} ä¸ªç¤¾ç¾¤ Â· ${categories.length} ä¸ªåˆ†ç±»`;

      // category row
      renderCategoryRow(matchIds);

      // detail title + groups
      const activeCat = categories.find(c => c.id === activeCategoryId);
      const baseGroups = flattenGroups(activeCategoryId);
      const shownGroups = matchIds.size
        ? baseGroups.filter(g => matchIds.has(g.id))
        : baseGroups;

      if (matchIds.size) {
        const title = activeCat ? `${activeCat.label} Â· æœç´¢ç»“æœ` : 'å…¨éƒ¨ Â· æœç´¢ç»“æœ';
        detailTitle.textContent = title;
        detailSub.textContent = `${shownGroups.length} ä¸ªåŒ¹é…`;
      } else {
        detailTitle.textContent = activeCat ? activeCat.label : 'å…¨éƒ¨ç¤¾ç¾¤';
        detailSub.textContent = `${shownGroups.length} ä¸ªç¤¾ç¾¤`;
      }

      // root active state
      rootNode.classList.toggle('active', activeCategoryId === 'all');

      renderGroupGrid(shownGroups, matchIds);

      requestAnimationFrame(drawLines);
      setTimeout(drawLines, 60);
    }

    // wire up
    rootNode.addEventListener('click', () => {
      activeCategoryId = 'all';
      updateView();
    });
    rootNode.addEventListener('dblclick', openRootModal);

    updateView();

    nodeModalClose.addEventListener('click', closeNodeModal);
    nodeModal.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'nodeModal') closeNodeModal();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && nodeModal.classList.contains('active')) closeNodeModal();
    });

    let drawTimer;
    window.addEventListener('resize', () => {
      clearTimeout(drawTimer);
      drawTimer = setTimeout(drawLines, 120);
    });

    let searchTimer;
    searchInput.addEventListener('input', () => {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(updateView, 80);
    });
  </script>
</body>
</html>

