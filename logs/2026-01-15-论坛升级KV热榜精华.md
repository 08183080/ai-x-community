# 2026-01-15 - 论坛升级KV热榜精华

## 目标
将论坛从仅本地存储（localStorage）升级为多人共享的轻后端论坛，使用 Vercel KV 存储，并添加最新/最热/精华排序、点赞功能。

## 主要改动

### 1. 新增依赖
- 创建 `package.json`，引入 `@vercel/kv` 用于 Vercel KV 存储

### 2. 新增 API 接口
- `api/forum-posts.js` - 获取帖子列表（支持最新/最热/精华排序）和创建新帖子
- `api/forum-vote.js` - 点赞功能
- `api/forum-feature.js` - 管理员设置精华帖子（需要 `FORUM_ADMIN_TOKEN`）

### 3. 前端升级（forum.html）
- 从 localStorage 切换为 API 调用
- 添加排序切换：最新 / 最热 / 精华
- 添加搜索框（本地过滤）
- 每条帖子添加点赞按钮
- 精华帖子显示标识

### 4. 数据模型
- Post: `{ id, nickname, content, tag, createdAt, upvotes }`
- KV 存储结构：
  - `forum:post:{id}` - 帖子详情
  - `forum:posts:new` - 最新排序（ZSET，score=时间戳）
  - `forum:posts:hot` - 最热排序（ZSET，score=点赞数*1e13+时间戳）
  - `forum:posts:featured` - 精华帖子ID集合（SET）

## 部署配置

需要在 Vercel 项目中配置以下环境变量：
- `KV_REST_API_URL` - Vercel KV REST API URL
- `KV_REST_API_TOKEN` - Vercel KV REST API Token
- `FORUM_ADMIN_TOKEN` - 管理员令牌（用于设置精华）

## 管理员操作示例

设置帖子为精华：
```bash
curl -X POST https://your-domain.com/api/forum-feature \
  -H "Content-Type: application/json" \
  -H "x-admin-token: YOUR_ADMIN_TOKEN" \
  -d '{"id": "post_id", "featured": true}'
```

## 技术要点
- 使用 Vercel KV（Redis）作为存储，无需数据库
- 热度算法：点赞数 * 1e13 + 时间戳（确保点赞优先，时间次之）
- 前端搜索使用本地过滤，避免服务端全文检索
- 保持极简设计，不做账号系统
