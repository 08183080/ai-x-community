# 2026-01-16 Vercel自动扫描城市图片并点击展示

## 用户需求
- Vercel 上自动扫描 `AI+X_history_data/地图` 下的“城市子文件夹”，点击对应城市时展示该文件夹里的图片。

## 实现
- 新增接口：`/api/city-photos`
  - 扫描 `AI+X_history_data/地图/<城市>/` 下的图片（png/jpg/jpeg/webp/gif）
  - 返回：`{ 城市: { title, note, photos:[{src,title}] } }`
  - 支持可选 `meta.json`（用于自定义标题/注释/图片标题）
  - 图片 `src` 走 `/api/file?path=...`（避免 Vercel 直接访问静态路径 404）
- `jianghu.html`
  - 页面启动时拉取 `/api/city-photos`
  - 在省内点击“市”时自动弹窗展示对应图片（多张可点图切换）
  - 修复照片库加载失败时的递归重试导致“死循环/重复加载”
  - 图片加载失败时自动显示诊断信息（HTTP 状态码 + 返回内容片段）
- 修正 `api/geo.js` 为 CommonJS，和现有 Vercel API 代码风格一致

## 示例数据
- `AI+X_history_data/地图/嘉兴/1.png`
- `AI+X_history_data/地图/嘉兴/meta.json`（标题：香海禅寺·图书馆）

